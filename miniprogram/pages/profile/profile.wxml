<!--我的页面-->
<view class="profile-container">
  <!-- 用户信息区域 -->
  <view class="user-info-section">
    <view class="user-info" wx:if="{{userInfo}}">
      <!-- 头像昵称填写组件 -->
      <button 
        class="avatar-nickname-btn"
        open-type="chooseAvatar"
        bind:chooseavatar="onChooseAvatar"
      >
        <t-avatar 
          class="user-avatar"
          size="large"
          image="{{userInfo.avatar}}"
        />
      </button>
      
      <view class="user-details">
        <!-- 昵称显示区域 -->
        <view class="nickname-section">
          <view class="nickname-display">
            <text class="nickname-text">{{userInfo.nickname}}</text>
            <view class="edit-btn" bindtap="onEditNicknameTap">
              <text class="edit-icon">✏️</text>
            </view>
          </view>
        </view>
        
        <text class="user-stats">已创作 {{myArtworks.length}} 幅作品</text>
      </view>
    </view>
    
    <!-- 未登录状态 -->
    <view class="login-section" wx:else>
      <t-avatar 
        class="default-avatar"
        size="large"
        icon="user"
      />
      <view class="login-info">
        <text class="login-title">欢迎使用AI画廊</text>
        <text class="login-subtitle">登录后可以保存和分享你的作品</text>
      </view>
      <t-button 
        class="login-btn"
        theme="primary"
        size="medium"
        bind:tap="onLoginTap"
      >
        微信一键登录
      </t-button>
    </view>
  </view>

  <!-- 个人画廊 -->
  <view class="gallery-section" wx:if="{{userInfo}}">
    <view class="section-header">
      <text class="section-title">个人画廊</text>
      <text class="section-subtitle">管理你的创作作品</text>
    </view>
    
    <scroll-view 
      class="gallery-scroll"
      scroll-y="true"
      bindscrolltolower="onLoadMore"
      lower-threshold="100"
      wx:if="{{myArtworks.length > 0}}"
    >
      <view class="gallery-grid">
        <view 
          class="gallery-item" 
          wx:for="{{myArtworks}}" 
          wx:key="id"
          bindtap="onGalleryItemTap"
          data-artwork="{{item}}"
        >
          <!-- 图片区域 -->
          <view class="image-container">
            <t-image
              class="gallery-image"
              src="{{item.imageUrl}}"
              mode="aspectFill"
              loading="lazy"
              error="图片加载失败"
              bind:error="onImageError"
            />
          </view>
          
          <!-- 提示词区域 -->
          <view class="prompt-section" wx:if="{{item.prompt}}">
            <text class="prompt-text">{{item.prompt}}</text>
          </view>
        </view>
        
        <!-- 添加新作品按钮 -->
        <view class="add-item" bindtap="onCreateTap">
          <view class="add-icon">
            <text class="add-text">+</text>
          </view>
          <text class="add-label">创作新作品</text>
        </view>
      </view>
      
      <!-- 加载更多 -->
      <view class="load-more" wx:if="{{loading}}">
        <t-loading theme="circular" size="40rpx" />
        <text class="load-text">加载更多...</text>
      </view>

      <!-- 没有更多数据 -->
      <view class="no-more" wx:if="{{!hasMore && myArtworks.length > 0}}">
        <text>没有更多作品了</text>
      </view>
    </scroll-view>
    
    <!-- 空状态 -->
    <view class="empty-gallery" wx:else>
      <t-image
        class="empty-image"
        src="/assets/images/empty-gallery.png"
        mode="aspectFit"
      />
      <text class="empty-text">还没有作品，快来创作第一幅吧！</text>
      <t-button 
        class="create-btn"
        theme="primary"
        size="medium"
        bind:tap="onCreateTap"
      >
        开始创作
      </t-button>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section" wx:if="{{userInfo}}">
    <t-cell-group>
      <t-cell 
        title="我的收藏" 
        left-icon="heart"
        arrow
        bind:tap="onMenuTap"
        data-type="favorites"
      />
      <t-cell 
        title="创作历史" 
        left-icon="time"
        arrow
        bind:tap="onMenuTap"
        data-type="history"
      />
      <t-cell 
        title="设置" 
        left-icon="setting"
        arrow
        bind:tap="onMenuTap"
        data-type="settings"
      />
    </t-cell-group>
  </view>

  <!-- 加载状态 -->
  <view class="loading-section" wx:if="{{loading}}">
    <t-loading theme="circular" size="40rpx" />
    <text class="loading-text">加载中...</text>
  </view>
</view>

<!-- 昵称编辑弹框 -->
<t-dialog
  visible="{{showNicknameDialog}}"
  title="修改昵称"
  content="请输入新的昵称"
  confirm-btn="确定"
  cancel-btn="取消"
  bind:confirm="onConfirmNicknameTap"
  bind:cancel="onCancelNicknameTap"
  bind:close="onNicknameDialogClose"
  close-on-overlay-click="{{true}}"
>
  <view slot="content" class="nickname-dialog-content">
    <t-input
      class="nickname-input"
      value="{{tempNickname}}"
      placeholder="请输入昵称"
      maxlength="20"
      bind:change="onNicknameChange"
      bind:focus="onNicknameFocus"
      bind:blur="onNicknameBlur"
      focus="{{showNicknameDialog}}"
    />
    <view class="input-tips">
      <text class="tips-text">昵称长度不超过20个字符</text>
    </view>
  </view>
</t-dialog>

<!-- Toast提示 -->
<t-toast id="t-toast" />
