<!--我的页面-->
<view class="profile-container">
  <!-- 用户信息区域 -->
  <view class="user-info-section">
    <view class="user-info" wx:if="{{userInfo}}">
      <!-- 头像昵称填写组件 -->
      <button 
        class="avatar-nickname-btn"
        open-type="chooseAvatar"
        bind:chooseavatar="onChooseAvatar"
      >
        <t-avatar 
          class="user-avatar"
          size="large"
          image="{{userInfo.avatar}}"
        />
      </button>
      
      <view class="user-details">
        <input 
          class="nickname-input"
          type="nickname"
          placeholder="请输入昵称"
          value="{{userInfo.nickname}}"
          bind:change="onNicknameChange"
          bind:blur="onNicknameBlur"
        />
        <text class="user-stats">已创作 {{myArtworks.length}} 幅作品</text>
      </view>
    </view>
    
    <!-- 未登录状态 -->
    <view class="login-section" wx:else>
      <t-avatar 
        class="default-avatar"
        size="large"
        icon="user"
      />
      <view class="login-info">
        <text class="login-title">欢迎使用AI画廊</text>
        <text class="login-subtitle">登录后可以保存和分享你的作品</text>
      </view>
      <t-button 
        class="login-btn"
        theme="primary"
        size="medium"
        bind:tap="onLoginTap"
      >
        微信一键登录
      </t-button>
    </view>
  </view>

  <!-- 个人画廊 -->
  <view class="gallery-section" wx:if="{{userInfo}}">
    <view class="section-header">
      <text class="section-title">个人画廊</text>
      <text class="section-subtitle">管理你的创作作品</text>
    </view>
    
    <view class="gallery-grid" wx:if="{{myArtworks.length > 0}}">
      <view 
        class="gallery-item" 
        wx:for="{{myArtworks}}" 
        wx:key="id"
        bindtap="onGalleryItemTap"
        data-artwork="{{item}}"
      >
        <t-image
          class="gallery-image"
          src="{{item.imageUrl}}"
          mode="aspectFill"
          loading="lazy"
        />
        <view class="gallery-overlay">
          <text class="gallery-title">{{item.title}}</text>
        </view>
      </view>
      
      <!-- 添加新作品按钮 -->
      <view class="add-item" bindtap="onCreateTap">
        <view class="add-icon">
          <text class="add-text">+</text>
        </view>
        <text class="add-label">创作新作品</text>
      </view>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-gallery" wx:else>
      <t-image
        class="empty-image"
        src="/assets/images/empty-gallery.png"
        mode="aspectFit"
      />
      <text class="empty-text">还没有作品，快来创作第一幅吧！</text>
      <t-button 
        class="create-btn"
        theme="primary"
        size="medium"
        bind:tap="onCreateTap"
      >
        开始创作
      </t-button>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section" wx:if="{{userInfo}}">
    <t-cell-group>
      <t-cell 
        title="我的收藏" 
        left-icon="heart"
        arrow
        bind:tap="onMenuTap"
        data-type="favorites"
      />
      <t-cell 
        title="创作历史" 
        left-icon="time"
        arrow
        bind:tap="onMenuTap"
        data-type="history"
      />
      <t-cell 
        title="设置" 
        left-icon="setting"
        arrow
        bind:tap="onMenuTap"
        data-type="settings"
      />
    </t-cell-group>
  </view>

  <!-- 加载状态 -->
  <view class="loading-section" wx:if="{{loading}}">
    <t-loading theme="circular" size="40rpx" />
    <text class="loading-text">加载中...</text>
  </view>
</view>

<!-- Toast提示 -->
<t-toast id="t-toast" />
