# 云开发功能测试指南

## 🚀 快速开始

### 1. 打开微信开发者工具
- 确保项目已正确加载
- 确保云开发环境已配置

### 2. 打开控制台
- 点击顶部菜单栏的"调试器"
- 选择"Console"标签页

### 3. 加载测试脚本
将 `test-cloud-functions.js` 文件的内容复制到控制台中，然后按回车执行。

## 📋 测试步骤

### 步骤1：运行完整测试
```javascript
runAllTests();
```

### 步骤2：查看测试结果
- ✅ 表示测试通过
- ❌ 表示测试失败
- 查看错误信息进行问题排查

### 步骤3：单独测试（可选）
如果某个功能有问题，可以单独测试：

```javascript
// 测试云开发环境
testCloudInit();

// 测试数据库集合
testCollections();

// 测试云函数部署
testCloudFunctions();

// 测试具体功能
testUserLogin();
testUpdateUserInfo();
```

## 🔍 测试结果解读

### 成功的测试结果
```
=== 开始云开发功能测试 ===
开始测试云开发环境初始化...
✅ 云开发SDK已加载
✅ 云开发环境ID: zou-cloud1-4gee2jb2b028dcdc
开始测试数据库集合...
✅ users集合存在且可访问
✅ artworks集合存在且可访问
开始测试云函数部署状态...
✅ userLogin 云函数部署正常
✅ updateUserInfo 云函数部署正常
开始测试云数据库连接...
云数据库测试结果: {data: Array(0), errMsg: "collection.get:ok"}
开始测试用户登录云函数...
用户登录云函数测试结果: {result: {success: true, userInfo: {...}, isNewUser: true}, errMsg: "cloud.callFunction:ok"}
开始测试更新用户信息云函数...
更新用户信息云函数测试结果: {result: {success: true, userInfo: {...}}, errMsg: "cloud.callFunction:ok"}
=== 云开发功能测试完成 ===
```

### 常见错误及解决方案

#### 错误1：云开发SDK未加载
```
❌ 云开发SDK未加载
```
**解决方案：**
- 检查基础库版本是否 >= 2.2.3
- 确保在真机上测试（模拟器可能不支持）

#### 错误2：云函数不存在
```
❌ userLogin 云函数测试失败: Error: 云函数不存在
```
**解决方案：**
- 确保云函数已正确部署
- 检查云函数名称是否正确
- 在云开发控制台查看云函数列表

#### 错误3：数据库集合不存在
```
❌ users集合测试失败: Error: 集合不存在
```
**解决方案：**
- 在云开发控制台创建数据库集合
- 检查集合名称是否正确
- 设置正确的数据库权限

#### 错误4：权限不足
```
❌ 数据库操作失败: Error: 权限不足
```
**解决方案：**
- 检查数据库集合的权限设置
- 确保用户已正确登录
- 检查云函数中的权限配置

## 🛠️ 故障排除

### 1. 云函数部署问题
- 确保云函数代码正确
- 检查云函数依赖是否安装
- 查看云函数日志

### 2. 数据库权限问题
- 检查集合权限设置
- 确保权限规则正确
- 测试不同权限级别

### 3. 环境配置问题
- 检查云开发环境ID
- 确保环境已开通
- 验证AppID配置

## 📱 真机测试

### 重要提醒
- 云开发功能建议在真机上测试
- 模拟器可能无法正常使用云开发
- 确保真机已登录微信

### 真机测试步骤
1. 在微信开发者工具中点击"预览"
2. 用微信扫描二维码
3. 在真机上打开小程序
4. 在真机上测试登录功能
5. 查看真机控制台日志

## 📊 测试报告

测试完成后，你应该能够：
- ✅ 成功登录微信
- ✅ 创建用户记录
- ✅ 更新用户信息
- ✅ 保存作品到数据库
- ✅ 从数据库加载作品

如果所有测试都通过，说明云开发功能配置正确，可以正常使用！
